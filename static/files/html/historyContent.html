<script type="text/javascript" src="/files/js/pageScript.js"></script>
<link rel="stylesheet" type="text/css" href="/files/css/history.css">  

  <div class = "content-container">
   <div class = "card summary">
    <h3 class="pageTitle"> Information &amp; History </h3>
  </div>
</div>

<div class = "card box content-container">
  <div class = "">
    <div class="title"> General Information </div>
  </div>
  <div class="row">
    <div class="col">
      <div>
        <div class="subTitle">At a glance</div>
        <div class="row box">
          <div class="col-md-1">
            <div> Sex: </div>
            <div> Age: </div>
            <div> Height: </div>
            <div> Weight: </div>
          </div>
          <div class="col-md-3">
            <div> M </div>
            <div> 3 y 4 m </div>
            <div> 100 cm </div>
            <div> 20 kg </div>

          </div>
          <div class="col-md-2">
            <div> Date of birth: </div>
            <div> Allergies: </div>
            <div> House: </div>
            <div> Date arrived at PC: </div>
          </div>
          <div class="col-md-6">
            <div> 01/02/2001 </div>
            <div> Peanuts </div>
            <div> Emseni 4 </div>
            <div> 02/02/2004 </div>

          </div>
        </div>
      </div>

    </div>
  </div>


  <div id="livingHistoryForm" class="box card section">
    <table class="w3-table-all">
      <div class="subTitle">
        Living History
      </div>
      <thead>
        <tr class="w3-light-grey">
          <th>Diagnosis</th>
          <th>Details</th>
          <th>Treatment</th>
          <th>Date of Onset</th>
          <th>Date of Resolution</th>
          <th class="edit">Edit</th>
        </tr>
      </thead>
      <tbody id="chronicTableBody">
      </tbody>
    </table>
    <form id="chronicForm" class="tr addForm collapse">
      <span class="td">
        <input type="text" name="chronicDiagnosis" placeholder="Diagnosis">
      </span>
      <span class="td">
        <input type="text" name="chronicDetails" placeholder="Details">
      </span>
      <span class="td">
        <input type="text" name="chronicTreatment" placeholder="Treatment">
      </span>
      <span class="td">
        <input type="text" name="chronicOnset" class="datepicker form-control">
      </span>
      <span class="td">
        <input type="text" name="chronicResolution" placeholder="Resolution">
      </span>
      <input type="submit" value="Submit" id="chronicSubmit" name="chronicSubmit" class="btn btn-primary formSubmit">
      <input type="button" value="Cancel" name="cancel" class="btn btn-danger formSubmit cancel" data-toggle="collapse" data-target="#chronicForm">
    </form>
    <div>
      <button id="addChronicProb" class="add" data-toggle="collapse" data-target="#chronicForm" aria-expanded="false" aria-controls="collapseExample">
        + </button>
    </div>
  </div>
  




  <form id="livingHistoryForm" class="box card section">
    <div class="row">
      <span class="col"><input type="text" name="house" placeholder="House"></span>
      <span class="col"><input type="text" name="startAge" placeholder="Start Age"></span>
      <span class="col"><input type="text" name="livingFrom" class="datepicker form-control" ></span>
      <span class="col"><input type="text" name="livingTo" class="datepicker form-control" ></span>
    </div>
    <div>
      <input type="submit" value="Submit" name="livingSubmit" class="formSubmit">
      <input type="button" value="Cancel" name="cancel" class="formSubmit cancel"></div>
    </form>

    <div> <button id="addLivingHistory" class="add"> + </button>
    </div>
  </div>

    <div id="livingHistory" class="box card section">
      <table class="w3-table-all">
        <div class="subTitle">
         Living History 
       </div>
       <thead>
        <tr class="w3-light-grey">
          <th>House</th>
          <th>Start Age</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th class="edit">Edit</th>
        </tr>
      </thead>
      <tbody id="livingTableBody" >
      </tbody>
    </table>
    <form id="livingForm" class="tr addForm collapse">
        <span class="td"><input type="text" name="house" placeholder="House"></span>
        <span class="td"><input type="text" name="startAge" placeholder="Start Age"></span>
        <span class="td"><input type="text" name="startDate" class="datepicker form-control"></span>
        <span class="td"><input type="text" name="endDate" class="datepicker form-control" ></span>
        <input type="submit" value="Submit" id="livingSubmit" name="livingSubmit" class="btn btn-primary formSubmit">
        <input type="button" value="Cancel" name="cancel" class="btn btn-danger formSubmit cancel" data-toggle="collapse" data-target="#livingForm">
    </form>
    <div>                               
      <button id="addLivingProb" class="add" data-toggle="collapse" data-target="#livingForm" aria-expanded="false" aria-controls="collapseExample"> + </button>
    </div>
  </div>

  <div id="feedingHistory" class="box card section">
    <table class="w3-table-all">
      <div class="subTitle">
       Feeding History 
     </div>
     <thead>
      <tr class="w3-light-grey">
        <th>Underweight</th>
        <th>Brand</th>
        <th>Amount</th>
        <th>Additions</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th class="edit">Edit</th>
      </tr>
    </thead>
    <tbody id="feedingTableBody" >
    </tbody>
  </table>
  <form id="feedingForm" class="tr addForm collapse">
      <span class="td"><input type="text" name="underweight" placeholder="House"></span>
      <span class="td"><input type="text" name="brand" placeholder="Brand"></span>
      <span class="td"><input type="text" name="amount" placeholder="Amount"></span>
      <span class="td"><input type="text" name="additions" placeholder="Additions"></span>
      <span class="td"><input type="text" name="startDate" class="datepicker form-control"></span>
      <span class="td"><input type="text" name="endDate" class="datepicker form-control" ></span>
      <input type="submit" value="Submit" id="feedingSubmit" name="feedingSubmit" class="btn btn-primary formSubmit">
      <input type="button" value="Cancel" name="cancel" class="btn btn-danger formSubmit cancel" data-toggle="collapse" data-target="#feedingForm">
  </form>
  <div>                               
    <button id="addFeedingProb" class="add" data-toggle="collapse" data-target="#feedingForm" aria-expanded="false" aria-controls="collapseExample"> + </button>
  </div>
</div>


    <form id="feedingHistoryForm" class="addForm" method="post" >
      <div class="row">
        <span class="col"><input type="radio" name="underweight"></span>
        <span class="col"><input type="text" name="brand" placeholder="Brand"></span>
        <span class="col"><input type="text" name="amount" placeholder="Amount per day"></span>
        <span class="col"><input type="text" name="additions" placeholder="Additions"></span>
        <span class="col"><input type="text" name="from" class="datepicker form-control" ></span>
        <span class="col"><input type="text" name="to" class="datepicker form-control" ></span>
      </div>
      <div>
        <input type="submit" value="Submit" name="feedingSubmit" class="formSubmit">
        <input type="button" value="Cancel" name="cancel" class="formSubmit cancel"></div>
      </form>

      <div> <button id="addFeedingHistory" class="add"> + </button>
      </div>
    </div>

    <div class = "card box content-container section">
      <span class="section">
        <div class = "header">
          <div class="title"> Social History
            <button class="editCard btn" style="float: right;">Edit</button>
          </div>
        </div>
        <div class="box2 container1">
          <div class="row">
            <div class="col-md-2"><div> Location: </div></div>
            <div class="col-md-2"><div> Mbabane</div></div>
          </div>
          <div class="row">
            <div class="col-md-2"><div> Mother: </div></div>
            <div class="col-md-2"><div> Wendy Dlamini</div></div>
          </div>
          <div class="row">
            <div class="col-md-2"><div> Father: </div></div>
            <div class="col-md-2"><div>  --- </div></div>
          </div>
        </div>

        <form id="socialHistoryForm" class="addForm" method="post" >

          <div class="row">
            <div class="col-md-1"><div> Location: </div></div>
            <div class="col-md-2"><input type="text" name="location" placeholder="Location"></div>
          </div>
          <div class="row">
            <div class="col-md-1"><div> Mother: </div></div>
            <div class="col-md-2"><div><input type="text" name="mother" placeholder="Mother"></div></div>
          </div>
          <div class="row">
            <div class="col-md-1"><div> Father: </div></div>
            <div class="col-md-2"><div><input type="text" name="father" placeholder="Father"></div></div>
          </div>

          <div>
            <input type="submit" value="Submit" name="socialHistorySubmit" class="formSubmit">
            <input type="button" value="Cancel" name="cancel" class="formSubmit cancelCardEdit"></div>
          </form>

        </span>
        <span class="section">
          <div class = "header">
            <div class="title"> Background 
              <button class="editCard btn" style="float: right;">Edit</button></div>
            </div>

            <div class="box2 container1">
              <div class="row">
                <div class="col">
                  <div id="backgroundInfo"> Left on side of road </div>
                </div>
              </div>
            </div>

            <form id="backgroundForm" class="addForm" method="post" >
              <textarea type="text" name="background" ></textarea>
              <div>
                <input type="submit" value="Submit" name="backgroundSubmit" class="formSubmit">
                <input type="button" value="Cancel" name="cancel" class="formSubmit cancelCardEdit">
              </div>
            </form>

          </span>

        </div>
      </div>

<script> 
var patientId = <%=data.id%>;
$(document).ready(function(){
// // we return a JSON in which we call updateTable with 
  $.ajax({
      type: "POST",
      url: "/getAllLivingHistory",
      data : {
        id: patientId
      },
      success: function(data) {
        console.log(data);
        if(data.data.length != 0){
          updateTableLiving(data.data[0].livingHistory);
        }
      }
  });
  $.ajax({
      type: "POST",
      url: "/getAllFeedingHistory",
      data : {
        id: patientId
      },
      success: function(data) {
        console.log(data);
        if(data.data.length != 0){
          updateTableFeeding(data.data[0].feedingHistory);
        }
      }
  });
  // ajax call that on submit will send the new feeding problem values to the database
  $('#livingSubmit').click(function(e) {
    e.preventDefault();
    var input = $("#livingForm").serializeArray();
    $.ajax({
        type: "POST",
        url: "/submitLiving",
        data : {
          id: patientId, 
          house: input[0].value,
          startAge: input[1].value, 
          startDate: input[2].value,
          endDate: input[3].value,  
        },
        success: function(data) {
          updateTableLiving(data.data[0].livingHistory);
        }
    });
  });

  $('#feedingSubmit').click(function(e) {
    e.preventDefault();
    var input = $("#feedingForm").serializeArray();
    $.ajax({
        type: "POST",
        url: "/submitFeeding",
        data : {
          id: patientId, 
          underweight: input[0].value,
          brand: input[1].value, 
          amount: input[2].value,
          additions: input[3].value,  
          startDate: input[4].value,
          endDate: input[5].value
        },
        success: function(data) {
          updateTableFeeding(data.data[0].feedingHistory);
        }
    });
  });
  
  // function that takes in JSON with two fields: height and date and renders the table as such
  var updateTableLiving = function(data) {
       var table1 = '';
       for(var i = 0; i < data.length; i++) {
           var line = '<tr><td>' +  data[i].house + '</td>';
           line += '<td>' + data[i].startAge + '</td>';
           line += '<td>' + data[i].startDate + '</td>';
           line += '<td>' + data[i].endDate + '</td>';
           line += '<td><button class="editBtn btn">Edit</button></td></tr>';
           table1 += line;
       }
       document.getElementById('livingTableBody').innerHTML = table1;
  };
  var updateTableFeeding = function(data) {
       var table1 = '';
       for(var i = 0; i < data.length; i++) {
           var line = '<tr><td>' +  data[i].underweight + '</td>';
           line += '<td>' + data[i].brand + '</td>';
           line += '<td>' + data[i].amount + '</td>';
           line += '<td>' + data[i].additions + '</td>';
           line += '<td>' + data[i].startDate + '</td>';
           line += '<td>' + data[i].endDate + '</td>';
           line += '<td><button class="editBtn btn">Edit</button></td></tr>';
           table1 += line;
       }
       document.getElementById('feedingTableBody').innerHTML = table1;
  };
});  
</script>
