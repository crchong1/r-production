
<!DOCTYPE html>
<html>

<head>
	

	<title>Patient Page</title>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
	integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
	crossorigin="anonymous"></script>
	<script type="text/javascript" src="/files/js/stickyfillmin.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="/files/js/pageScript.js"></script>

	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Nunito"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
	integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Pacifico"/>
	<link rel="stylesheet" type="text/css" href="/files/css/views.css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.css" rel="stylesheet" type="text/css" />


</head>
<body> 
	<div class="background">
		<div class="sidebarContainer">
			<div class="row">
				<nav class="col-md-2 sidebar">
					<div class = "sidebar sticky " >
						<div class = "basicInfo"> 
							<h2 id = "name"><%= data.firstName%> <%= data.lastName%></h2>
							<br>
							<p id="ageSex"> (Age) 19, <%=data.sex%> </p>
							<p id="dob"><%= data.birthdate%></p>
							<p id="weightHeight"> <%= data.weight%> kg, <%= data.height%> cm </p>
							<p id="allergiesSide"> Allergies: (loop patient.allergies[i]) </p>
						</div>
						<ul class="nav nav-pills nav-stacked links">
							<li class="active current"><a href='/patientPage/<%=data.id%>'>Patient Summary</a></li>
							<li><a href="/patientPage/<%=data.id%>/history">Information &amp; History </a></li>
							<li><a href="/patientPage/<%=data.id%>/problemList">Problem List</a></li>
							<li><a href="/patientPage/<%=data.id%>/medications">Medication List</a></li>
							<li><a href="/patientPage/<%=data.id%>/immunization">Immunization Record</a></li>
							<li><a href="/patientPage/<%=data.id%>/allergies">Allergies</a></li>
							<li><a href="/patientPage/<%=data.id%>/wellChildCheck">Well Child Check Page</a></li>
							<li><a href="/patientPage/<%=data.id%>/wellChildCheckForm">Well Child Check Form</a></li>
							<li><a href="/patientPage/<%=data.id%>/testing">Testing</a></li>
							<li><a href="/patientPage/<%=data.id%>/growthCharts">Growth Charts</a></li>
							<li><a href="#section7">Nurse Notes</a></li>
							<li><a href="#section8">Scans</a></li>
						</ul>
					</div>
				</nav>
				<div class="col-md">   
					<div class = "card header">
						<div class = "topRight">
							<a> Welcome, "*User Name*"  | </a>
							<a href="/" class="btn btn-outline-success"> Logout </a>
						</div>
						<div>
						 <a href="/patientSearch" style="text-decoration : none "> <p class = "label" id = "R-plus"> R+ </p>
            <p class = "label" id = "Childrens">Childrens</p> </a>
							<a href="#Pharmacy" class = "top-nav" id = "pharmacy">Pharmacy</a>
							<a href="#AllPatients" class = "top-nav" id = "rec-pat">Recent Patients</a>
							<a href="/patientSearch" class = "top-nav" id = "search-pat">Search Patients</a>
							<a href="/form" class = "top-nav" id = "search-pat">Add Patient</a>

						</div>
					</div>
					
					<div class = "content-container">
						<div class = "card box summary">
							<h3 class="title"> Medication List </h3>
						</div>
						
						<div class="box card section">
							<table class="w3-table-all">
								<div class="subTitle">
									Chronic Medications 
								</div>
								<thead>
									<tr class="w3-light-grey">
										<th>Name of Rx</th>
										<th>Dose</th>
										<th>Time</th>
										<th>Route</th>
										<th>Start Date</th>
										<th>End Date</th>
										<th>Diagnosis</th>
										<th class='edit'>Edit</th>
									</tr>
								</thead>
								<tbody id="chronicMedTableBody" >
								</tbody>
							</table>
							<form id="chronicMedForm" class="tr addForm">
								<span class="td"><input type="text" name="chronicMedDrugName" placeholder="Drug Name"></span>
								<span class="td"><input type="text" name="chronicMedDose" placeholder="Dose"></span>
								<span class="td"><input type="text" name="chronicMedTime"	placeholder="Time"></span>
								<span class="td"><input type="text" name="chronicMedRoute" placeholder="Route"></span>
								<span class="td"><input type="text" name="chronicMedStartDate" class="datepicker form-control"></span>
								<span class="td"><input type="text" name="chronicMedEndDate" class="datepicker form-control" ></span>
								<span class="td"><input type="text" name="chronicMedDiagnosis" placeholder="Diagnosis"></span>

								<input type="submit" value="Submit" id="chronicMedSubmit" name="chronicMedSubmit" class="btn btn-primary formSubmit">
								<input type="button" value="Cancel" name="cancel" class="btn btn-danger formSubmit cancel" data-toggle="collapse" data-target="#chronicMedForm">
							</form>

							<div>                               
								<button id="addChronicMed" class="add" data-toggle="collapse" data-target="#chronicMedForm" aria-expanded="false" aria-controls="collapseExample"> + </button>
							</div>
						</div>


						
						<div class="box card section">
							<table class="w3-table-all">
								<div class="subTitle">
									Acute Medications 
								</div>
								<thead>
									<tr class="w3-light-grey">
										<th>Name of Rx</th>
										<th>Dose</th>
										<th>Time</th>
										<th>Route</th>
										<th>Start Date</th>
										<th>End Date</th>
										<th>Diagnosis</th>
										<th class='edit'>Edit</th>
									</tr>
								</thead>
								<tbody id="acuteMedTableBody" >
								</tbody>
							</table>
							<form id="acuteMedForm" class="tr addForm">
								<span class="td"><input type="text" name="acuteMedDrugName" placeholder="Drug Name" ></span>
								<span class="td"><input type="text" name="acuteMedDose" placeholder="Dose"></span>
								<span class="td"><input type="text" name="acuteMedTime" placeholder="Time"></span>
								<span class="td"><input type="text" name="acuteMedRoute" placeholder="Route"></span>
								<span class="td"><input type="text" name="acuteMedStartDate" class="datepicker form-control" ></span>
								<span class="td"><input type="text" name="acuteMedEndDate" class="datepicker form-control" ></span>
								<span class="td"><input type="text" name="acuteMedDiagnosis" placeholder="Diagnosis"></span>

								<input type="submit" value="Submit" id="acuteMedSubmit" name="acuteMedSubmit" class="btn btn-primary formSubmit">
								<input type="button" value="Cancel" name="cancel" class="btn btn-danger formSubmit cancel" data-toggle="collapse" data-target="#acuteMedForm">
							</form>

							<div>                               
								<button id="addAcuteMed" class="add" data-toggle="collapse" data-target="#acuteMedForm" aria-expanded="false" aria-controls="collapseExample"> + </button>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
<script type="text/javascript">
	var patientId = <%=data.id%>;
	$('document').ready(function() {
	  console.log("document.ready ajax call: ");
		// // ajax call to render the original table, where we post to getAllChronicMed
		// // we return a JSON in which we call updateTable with 
		 $.ajax({
			 type: "POST",
			 url: "/getAllChronicMed",
			 data : {
			   id: patientId
			 },
			 success: function(data) {
			   console.log(data);
			   if(data.data.length != 0){
				updateTableChronicMed(data.data[0].chronicMedEntries);
			   }
			 }
		 });
		 $.ajax({
			 type: "POST",
			 url: "/getAllAcuteMed",
			 data : {
			   id: patientId
			 },
			 success: function(data) {
			   console.log(data);
			   if(data.data.length != 0){
				updateTableAcuteMed(data.data[0].acuteMedEntries);
			   }
			 }
		 });
		// ajax call that on submit will send the new chronic problem values to the database
		$('#chronicMedSubmit').click(function(e) {
		  e.preventDefault();
		  var input = $("#chronicMedForm").serializeArray();
		  $.ajax({
			  type: "POST",
			  url: "/chronicMed",
			  data : {
				id: patientId, 
				chronicMedName: input[0].value,
				chronicMedDose: input[1].value, 
				chronicMedTime: input[2].value,
				chronicMedRoute: input[3].value,  
				chronicMedStartDate: input[4].value,
				chronicMedEndDate: input[5].value,
				chronicMedDiagnosis: input[6].value,  
			  },
			  success: function(data) {
				console.log("New chronic med data: ");
				console.log(data);
				updateTableChronicMed(data.data[0].chronicMedEntries);
				$('#chronicMedForm')[0].reset();
              $('#chronicMedForm').hide();           
              $('#chronicMedForm').parent().find('button').show();
			  }
		  });
		});
		$('#acuteMedSubmit').click(function(e) {
		  e.preventDefault();
		  var input = $("#acuteMedForm").serializeArray();
		  $.ajax({
			  type: "POST",
			  url: "/acuteMed",
			  data : {
				id: patientId, 
				acuteMedName: input[0].value,
				acuteMedDose: input[1].value, 
				acuteMedTime: input[2].value,
				acuteMedRoute: input[3].value,  
				acuteMedStartDate: input[4].value,
				acuteMedEndDate: input[5].value,
				acuteMedDiagnosis: input[6].value,  
			  },
			  success: function(data) {
				console.log("New acute med data: ");
				console.log(data);
				updateTableAcuteMed(data.data[0].acuteMedEntries);
				$('#acuteMedForm')[0].reset();
              $('#acuteMedForm').hide();           
              $('#acuteMedForm').parent().find('button').show();
			  }
		  });
		});
	});
	
	// function that takes in JSON with chronic med fields and renders the table as such
	var updateTableChronicMed = function(data) {
		 console.log(data);
		 var table1 = '';
		 for(var i = 0; i < data.length; i++) {
			 var line = '<tr><td>' +  data[i].chronicMedName + '</td>';
			 line += '<td>' + data[i].chronicMedDose + '</td>';
			 line += '<td>' + data[i].chronicMedTime + '</td>';
			 line += '<td>' + data[i].chronicMedRoute + '</td>';
			 line += '<td>' + data[i].chronicMedStartDate + '</td>';
			 line += '<td>' + data[i].chronicMedEndDate + '</td>';
			 line += '<td>' + data[i].chronicMedDiagnosis + '</td>';
			 line += '<td><button class="editBtn btn">Edit</button></td></tr>';
			 table1 += line;
		 }
		 document.getElementById('chronicMedTableBody').innerHTML = table1;
	};
	var updateTableAcuteMed = function(data) {
		 console.log(data);
		 var table1 = '';
		 for(var i = 0; i < data.length; i++) {
		  var line = '<tr><td>' +  data[i].acuteMedName + '</td>';
		  line += '<td>' + data[i].acuteMedDose + '</td>';
		  line += '<td>' + data[i].acuteMedTime + '</td>';
		  line += '<td>' + data[i].acuteMedRoute + '</td>';
		  line += '<td>' + data[i].acuteMedStartDate + '</td>';
		  line += '<td>' + data[i].acuteMedEndDate + '</td>';
		  line += '<td>' + data[i].acuteMedDiagnosis + '</td>';
			 line += '<td><button class="editBtn btn">Edit</button></td></tr>';
			 table1 += line;
		 }
		 document.getElementById('acuteMedTableBody').innerHTML = table1;
	};
  
	</script>
</html>


